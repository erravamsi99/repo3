(()=>{var J=Object.create;var B=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,H=Object.prototype.hasOwnProperty;var v=(r,t)=>()=>(r&&(t=r(r=0)),t);var K=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var M=(r,t,i,b)=>{if(t&&typeof t=="object"||typeof t=="function")for(let g of q(t))!H.call(r,g)&&g!==i&&B(r,g,{get:()=>t[g],enumerable:!(b=V(t,g))||b.enumerable});return r};var Q=(r,t,i)=>(i=r!=null?J(F(r)):{},M(t||!r||!r.__esModule?B(i,"default",{value:r,enumerable:!0}):i,r));var u=(r,t,i)=>new Promise((b,g)=>{var w=p=>{try{k(i.next(p))}catch(m){g(m)}},S=p=>{try{k(i.throw(p))}catch(m){g(m)}},k=p=>p.done?b(p.value):Promise.resolve(p.value).then(w,S);k((i=i.apply(r,t)).next())});var P,U=v(()=>{P="WebPixel::Render"});var I,N=v(()=>{U();I=r=>shopify.extend(P,r)});var R=v(()=>{N()});var D=v(()=>{R()});var j=K(x=>{D();I(g=>u(x,[g],function*({analytics:r,browser:t,init:i,settings:b}){var k,p,m,C,T,E;let w="https://track.bixgrow.com/api";if(yield t.localStorage.getItem("isAppEmbedLoaded"))yield t.localStorage.removeItem("isAppEmbedLoaded"),console.log("App embed tracker already loaded, skipping...");else{let L=function(o,a){o=o.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+o+"(=([^&#]*)|&|#|$)"),e=c.exec(a);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null},O=function(o,a){t.cookie.set(o+"="+a+";path=/")},h=function(o,a,c){var e=new Date(c*1e3),n="expires="+e.toUTCString();t.cookie.set(o+"="+a+";"+n+";path=/")},$=function(o,a,c){var e=new Date;e.setTime(e.getTime()+c*24*60*60*1e3);var n="expires="+e.toUTCString();t.cookie.set(o+"="+a+";"+n+";path=/")},W=function(o){return o&&o.split("?")[0]};if(t.localStorage.setItem("isWebPixelLoaded",!0),console.log("BG pixel loaded"),(C=(m=(p=(k=i==null?void 0:i.context)==null?void 0:k.window)==null?void 0:p.location)==null?void 0:m.href)!=null&&C.includes("orders")){let a=i.context.window.location.href.split("/"),c=a[a.length-1],e=yield s("bgaffilite_id"),n=yield s("bgclick_id"),_=yield s("bgvisitor_id");if(n){let l={aff_id:e,visitor_id:_,click_id:n,event_type:"checkout_finish",order_id:c,shop:(E=(T=i==null?void 0:i.data)==null?void 0:T.shop)==null?void 0:E.myshopifyDomain};y(l)}}function s(o){return u(this,null,function*(){return yield t.cookie.get(o)})}function y(o){return u(this,null,function*(){let a=`${w}/bg_trackv2`;try{let c=yield fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(o)});c.ok||console.log("Bixgrow - network response was not ok");let e=yield c.json();e.event_type=="click"&&typeof e.visitor_id!="undefined"&&(h("bgvisitor_id",e.visitor_id,e.expire_at),h("bgaffilite_id",o.aff_id,e.expire_at),h("bglast_click",new Date().getTime(),e.expire_at),h("bgexpire_time",e.expire_at,e.expire_at),h("bgclick_id",e.click_id,e.expire_at))}catch(c){console.error("Bixgrow - error:",c)}})}function G(o,a){return u(this,null,function*(){var n,_;let c=o||a;if(!c)return 1;let e=`${w}/automatic-coupon-customer?shop=${(_=(n=i==null?void 0:i.data)==null?void 0:n.shop)==null?void 0:_.myshopifyDomain}&affiliateId=${c}`;try{let l=yield fetch(e,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});l.ok||console.log("Bixgrow - network response was not ok");let d=yield l.json().catch(()=>null);if(!d)return;d!=null&&d.couponCode&&O("discount_code",encodeURIComponent(d==null?void 0:d.couponCode))}catch(l){console.error("Bixgrow - error:",l)}})}r.subscribe("page_viewed",o=>u(x,null,function*(){let a=o.context,c=a.window.location.href,e=L("bg_ref",c),n=yield s("bgaffilite_id"),_=yield s("bglast_click"),l=yield s("bgvisitor_id"),d=setInterval(function(){return u(this,null,function*(){let f=yield s("cart"),X=yield s("bgcart"),A=yield s("bgclick_id");if(l!==""&&f!==""&&f!=X&&A){console.log("aaa"),$("bgcart",f,100),clearInterval(d);let z={aff_id:n,visitor_id:l,event_type:"add_to_cart",cart_token:W(f),click_id:A};y(z)}})},1e3);if(G(e,n),!e)return"";if(l===""){console.log(1);let f={aff_id:e,event_type:"click",referral_site:a.document.referrer,destination_url:c};y(f)}else if(n!=e){console.log(2);let f={aff_id:e,visitor_id:l,event_type:"click",referral_site:a.document.referrer,destination_url:a.window.location.href};y(f)}else if(new Date().getTime()-_>60*1e3){console.log(3);let f={aff_id:e,visitor_id:l,event_type:"click",referral_site:a.document.referrer,destination_url:a.window.location.href};y(f)}})),r.subscribe("checkout_completed",o=>u(x,null,function*(){var l,d;console.log(4);let a=o.data.checkout,c=yield s("bgaffilite_id"),e=yield s("bgclick_id"),n=yield s("bgvisitor_id"),_={aff_id:c,visitor_id:n,click_id:e,event_type:"checkout_finish",order_id:a.order.id,shop:(d=(l=i==null?void 0:i.data)==null?void 0:l.shop)==null?void 0:d.myshopifyDomain};(c||e||n)&&y(_)}))}}))});var se=Q(j());})();
